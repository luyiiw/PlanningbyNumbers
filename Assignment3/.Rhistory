person.dat <- person.dat[!(person.dat$WK_MODE %in% "0"),]
person.dat <- person.dat[!(person.dat$WK_MODE %in% "9"),]
## removing don't know and refused answer for PARK_SUB
person.dat <- person.dat[!(person.dat$PARK_SUB %in% "8"),]
person.dat <- person.dat[!(person.dat$PARK_SUB %in% "9"),]
## removing don't know and refused answer for TRAN_SUB
person.dat <- person.dat[!(person.dat$TRAN_SUB %in% "8"),]
person.dat <- person.dat %>%
mutate(education = as.factor(
recode(EDUCA,
`1` = "Below HS",
`2` = "HS Grad",
`3` = "Some College",
`4` = "Associate Degree",
`5` = "BS Degree",
`6` = "Graduate Degree",
`97` = "Other"))) %>%
mutate(driver_license = as.factor(
recode(LIC,
`1` = "Yes",
`2` = "No"))) %>%
mutate(transit_mode = as.factor(
recode(WK_MODE,
`1` = "Car",
`2` = "Carpool",
`3` = "Car and Transit",
`4` = "Tranist",
`5` = "Bicylce",
`6` = "Walking",
`7` = "Other",
`8` = "WFH"))) %>%
mutate(parking_subsidy = as.factor(
recode(PARK_SUB,
`1` = "Subsidized Parking",
`2` = "No Parking Subsidy",
`3` = "Free Parking"))) %>%
mutate(transit_subsidy = as.factor(
recode(TRAN_SUB,
`1` = "Subsidized Transit",
`2` = "No Transit Subsidy")))
person.dat <- person.dat %>%
select(HH_ID, PERSON_ID, education, driver_license, transit_mode, parking_subsidy, transit_subsidy)
household.dat <- household.dat %>%
select(HH_ID, H_COUNTY, A_TYPE, HH_SIZE, TOT_VEH, TOLL_ACCNT, INCOME)
#step 2. for each variable, remove meaningless values
## removing NA rows
household.dat <- na.omit(household.dat)
## removing TOLL_ACCNT don't know rows
household.dat <- household.dat[!(household.dat$TOLL_ACCNT %in% "98"),]
## removing INCOME don't know or refused rows
household.dat <- household.dat[!(household.dat$INCOME %in% "98"),]
household.dat <- household.dat[!(household.dat$INCOME %in% "99"),]
#step 3. recode values to more sensible categories
household.dat <- household.dat %>%
mutate(county = as.factor(
recode(H_COUNTY,
`42017` = "Bucks",
`42029` = "Chester",
`42045` = "Delaware",
`42091` = "Montgomery",
`42101` = "Philadelphia",
`34005` = "Burlington",
`34007` = "Camden",
`34015` = "Gloucester",
`34021` = "Mercer"))) %>%
mutate(area_type = as.factor(
recode(A_TYPE,
`1` = "CBD",
`2` = "CBD Fringe",
`3` = "Urban",
`4` = "Surburban",
`5` = "Rural",
`6` = "Open Rural")))
## renaming columns
household.dat <- household.dat %>%
rename(household_size = HH_SIZE) %>%
rename(total_veh = TOT_VEH) %>%
rename(toll_account = TOLL_ACCNT)
## re categorizing income
household.dat <- household.dat %>%
mutate(hh_income = case_when(
INCOME == '1' ~ 'low_income',
INCOME == '2' ~ 'low_income',
INCOME == '3' ~ 'low_income',
INCOME == '4' ~ 'low_income',
INCOME == '5' ~ 'middle_income',
INCOME == '6' ~ 'middle_income',
INCOME == '7' ~ 'middle_income',
INCOME >= '8' ~ 'high_income'))
#step 4. select only the relevant variables
household.dat <- household.dat %>%
select(-H_COUNTY, -A_TYPE, -INCOME)
View(person.dat)
View(trip.dat)
library(haven)
library(arm)
library(tidyverse)
dat <- merge(trip.dat, person.dat, by = "HH_ID", all.x = FALSE, all.y=FALSE, sort = FALSE)
dat <- merge(household.dat, dat, by = "HH_ID", all.x = FALSE, all.y=FALSE, sort = FALSE)
View(dat)
dat <- dat %>%
filter(Model_TravDist < 10,
Model_TravTime < 120)
#step 3. remove NAs. if this step leaves you with a few observations (say, a few hundred), then inspect variables to see
any(is.na(dat))
which(is.na(dat), arr.ind = TRUE)
sum(is.na(dat))
any(is.na(dat))
sum(is.na(dat))
ave.speed <- dat %>% group_by(transit_mode) %>%
summarise(ave_speed = mean(travel_dist/(travel_time/60)))
library(haven)
library(arm)
library(tidyverse)
ave.speed <- dat %>% group_by(transit_mode) %>%
summarise(ave_speed = mean(travel_dist/(travel_time/60)))
View(dat)
View(dat)
View(dat)
rm(list = ls())
library(haven)
library(arm)
library(tidyverse)
load("cpln505_assignment3_voting_data_abb.rda")
View(dat.voting)
table(dat.voting$VCF0704a)
table(dat.voting$VCF0704a)
table(dat.voting$VCF01114)
table(dat.voting$VCF0128)
table(dat.voting$VCF0140a)
table(dat.voting$VCF0148a)
table(dat.voting$VCF0302)
table(dat.voting$VCF0105a)
table(dat.voting$VCF0105a)
dat <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF01114, year = VCF0004, religion=VCF0128, education=VCF0140a, class=VCF0148a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, class, party, race) %>%
filter(race != 9, candidate != 0, education != 9, class !=9, party !=8 | 9) %>%
mutate(race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "Indian",
`5` = "Hispanic",
`6` = "other")))
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, class=VCF0148a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race) %>%
filter(race != 9, candidate != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`="lower income",
`2`="lower income",
`3`="middle income",
`4`="high income",
`5`="high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))
View(dat.voting)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race) %>%
filter(race != 9, candidate != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))
View(dat01)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race) %>%
filter(race != 9, candidate != 0, income != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(8, 9)) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(8, 9), !age <=17) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "Asian",
`4` = "American Indian",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`3` = "None",
`4` = "Other",
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
