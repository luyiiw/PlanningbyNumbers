scale_y_continuous(labels = scales::percent_format())
return(p)
}
# Apply function to each variable and store plots
plots <- lapply(variables_to_plot, function(v) prepare_and_plot(dat01, v))
print(plots[[1]])
grid.arrange(grobs = plots, ncol = 2)
dat2012 <- dat01 %>% select (year==2012)
dat2012 <- dat01 %>% filter (year==2012)
View(dat2012)
dat2016 <- dat01 %>% filter (year==2016)
mod.1 <- glm(candidate_cat ~  + age + race_cat +
candidate_cat + income_cat + religion_cat +
education_cat + party_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
mod.1 <- glm(candidate_cat ~ age + race_cat +
candidate_cat + income_cat + religion_cat +
education_cat + party_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.1)
logLik(mod.1)
logLik(mod.1)
100*(exp(mod.1$coefficients) - 1)
logLik(mod.1)*(-2
100*(exp(mod.1$coefficients) - 1)
100*(exp(mod.1$coefficients) - 1)
logLik(mod.1)*(-2)
null_model <- glm(candidate_cat ~ 1, data =  dat2012, family = binomial("logit"))
mcfadden_r2 <- 1 - (logLik(mod.1)/logLik(null_model))
print(mcfadden_r2)
logLik(mod.1)
logLik(mod.1)
logLik(mod.1)
summary(mod.1)
mod.1 <- glm(candidate_cat ~ age + race_cat +
income_cat + religion_cat +
education_cat + party_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.1)
mod.2 <- glm(candidate_cat ~ age + race_cat +
candidate_cat + income_cat + religion_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.2)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",,
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",,
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
rm(list = ls())
library(haven)
library(arm)
library(tidyverse)
load("cpln505_assignment3_voting_data_abb.rda")
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",,
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101) %>%
select(year, candidate, income, year, religion, education, party, race, age) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`5` = "Democrat")))%>%
select(-candidate,-income,-religion,-education,-party,-race)
library(dplyr)
library(tidyr)
library(ggplot)
plot_data <- dat01 %>%
count(year, race_cat, candidate_cat, income_cat, religion_cat, education_cat, party_cat
plot_data <- dat01 %>%
ggplot(plot_data, aes(x = as.factor(year), y = n, fill = as.factor(race_cat))) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_brewer(palette = "Dark2") +  # Using a more appropriate palette
labs(title = "Distribution of Race Categories by Year",
x = "Year",
y = "Count",
fill = "Race Category") +
theme_minimal()
plot_data <- dat01 %>%
count(year, race_cat, candidate_cat, income_cat, religion_cat, education_cat, party_cat)
ggplot(plot_data, aes(x = as.factor(year), y = n, fill = as.factor(race_cat))) +
geom_bar(stat = "identity", position = "dodge") +
scale_fill_brewer(palette = "Dark2") +  # Using a more appropriate palette
labs(title = "Distribution of Race Categories by Year",
x = "Year",
y = "Count",
fill = "Race Category") +
theme_minimal()
library(gridExtra)  # For arranging multiple plots
variables_to_plot <- c("race_cat", "candidate_cat", "income_cat", "religion_cat", "party_cat", "education_cat")
prepare_and_plot <- function(data, var_name) {
# Calculate percentages
percentage_data <- data %>%
group_by(year, !!sym(var_name)) %>%
summarise(count = n(), .groups = 'drop') %>%
group_by(year) %>%
mutate(total = sum(count),  # Total counts per year
percentage = (count / total) * 100)  # Calculate percentage
# Generate plot
p <- ggplot(percentage_data, aes(x = as.factor(year), y = percentage, fill = !!sym(var_name))) +
geom_bar(stat = "identity", position = position_dodge()) +
scale_fill_brewer(palette = "Set3") +
labs(title = paste("Percentage Distribution of", var_name, "by Year"),
x = "Year",
y = "Percentage",
fill = var_name) +
theme_minimal() +
scale_y_continuous(labels = scales::percent_format())
return(p)
}
plots <- lapply(variables_to_plot, function(v) prepare_and_plot(dat01, v))
grid.arrange(grobs = plots, ncol = 2)
print(plots[[1]])
scale_y_continuous(labels = scales::percent_format(), limits = c(0, 100))
print(head(percentage_data))
plots <- lapply(variables_to_plot, function(v) prepare_and_plot(dat01, v))
scale_y_continuous(labels = scales::percent_format(), limits = c(0, 100))
dat2012 <- dat01 %>% filter (year==2012)
dat2016 <- dat01 %>% filter (year==2016)
mod.1 <- glm(candidate_cat ~ age + race_cat +
income_cat + religion_cat +
education_cat + party_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.1)
mod.2 <- glm(candidate_cat ~ age + race_cat +
candidate_cat + income_cat + religion_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.2)
mod.3 <- glm(candidate_cat ~ age + race_cat +
income_cat + religion_cat +
education_cat + party_cat,
data = dat2016,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.3)
mod.4 <- glm(candidate_cat ~ age + race_cat +
candidate_cat + income_cat + religion_cat,
data = dat2016,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.4)
mod.4 <- glm(candidate_cat ~ age + race_cat +
income_cat + religion_cat +
education_cat + party_cat,
data = dat2016,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.4)
rm(list = ls())
library(haven)
library(arm)
library(tidyverse)
load("cpln505_assignment3_voting_data_abb.rda")
View(dat.voting)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101, gender=VCF0104) %>%
select(year, candidate, income, year, religion, education, party, race, age, gender) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17, gender= !3) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`5` = "Democrat")),
gender_cat=as.factor(recode(gender,
`1`="Male",
`2`="Female")))%>%
select(-candidate,-income,-religion,-education,-party,-race,-gender)
dat01 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101, gender=VCF0104) %>%
select(year, candidate, income, year, religion, education, party, race, age, gender) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17, gender !=3) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`5` = "Democrat")),
gender_cat=as.factor(recode(gender,
`1`="Male",
`2`="Female")))%>%
select(-candidate,-income,-religion,-education,-party,-race,-gender)
dat2012 <- dat01 %>% filter (year==2012)
dat2016 <- dat01 %>% filter (year==2016)
mod.1 <- glm(candidate_cat ~ age + race_cat + gender_cat+
income_cat + religion_cat +
education_cat + party_cat,
data = dat2012,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.1)
summary(mod.1)
View(dat2012)
View(dat01)
dat02 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101, gender=VCF0104) %>%
select(year, candidate, income, year, religion, education, party, race, age, gender) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17, gender !=3) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`5` = "Democrat")),
gender_cat=as.factor(recode(gender,
`1`="Male",
`2`="Female")),
age_cat=case_when(
age >= 17 & age <= 24 ~ "17-24",
age >= 25 & age <= 34 ~ "25-34",
age >= 35 & age <= 44 ~ "35-44",
age >= 45 & age <= 59 ~ "45-59",
age >= 60            ~ "60+" ))%>%
select(-candidate,-income,-religion,-education,-party,-race,-gender,-age)
library(haven)
library(arm)
library(tidyverse)
dat02 <- dat.voting %>% filter(VCF0004 == 2012 | VCF0004 == 2016) %>%
rename(candidate = VCF0704a, income=VCF0114, year = VCF0004, religion=VCF0128, education=VCF0140a, party=VCF0302, race = VCF0105a, age=VCF0101, gender=VCF0104) %>%
select(year, candidate, income, year, religion, education, party, race, age, gender) %>%
filter(race != 9, candidate != 0, income != 0, religion != 0, !education %in% c(8, 9), !party %in% c(3,4,8, 9), !age <=17, gender !=3) %>%
mutate(
race_cat = as.factor(recode(race,
`1` = "white",
`2` = "black",
`3` = "other",
`4` = "other",
`5` = "Hispanic",
`6` = "other")),
candidate_cat=as.factor(recode(candidate,
`1` = "Democrat",
`2` = "Republican")),
income_cat=as.factor(recode(income,
`1`= "lower income",
`2`= "lower income",
`3`= "middle income",
`4`= "high income",
`5`= "high income")),
religion_cat=as.factor(recode(religion,
`1`="Protestant",
`2`="Catholic",
`3`="Jewish",
`4`="Other")),
education_cat=as.factor(recode(education,
`1` = "Below HS",
`2` = "Below HS",
`3` = "HS",
`4` = "HS",
`5` = "Some College",
`6` = "BS Degree",
`7` = "Graduate Degree")),
party_cat=as.factor(recode(party,
`1` = "Republican",
`2` = "Independent",
`5` = "Democrat")),
gender_cat=as.factor(recode(gender,
`1`="Male",
`2`="Female")),
age_cat=case_when(
age >= 17 & age <= 24 ~ "17-24",
age >= 25 & age <= 34 ~ "25-34",
age >= 35 & age <= 44 ~ "35-44",
age >= 45 & age <= 59 ~ "45-59",
age >= 60            ~ "60+" ))%>%
select(-candidate,-income,-religion,-education,-party,-race,-gender,-age)
View(dat02)
dat201201<-dat02 %>% filter (year==2012)
dat201601 <- dat02 %>% filter (year==2016)
mod.11 <- glm(candidate_cat ~ age_cat + race_cat + gender_cat+
income_cat + religion_cat +
education_cat + party_cat,
data = dat201201,
na.action = na.exclude,
family = binomial("logit"))
summary(mod.11)
summary(mod.1)
